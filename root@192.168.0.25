#!/bin/sh

# Centreon install script by Denis Gourmel (nesousx) ;
# credits goes to Nicolargo

### User variables (modify this according to your needs)

NAGIOS_PASSWD_CLEAR=plop


### Script variables (only modify this if you know what you are doing)

APT=apt-get -y
NAGIOS_PASSWD_CRYPT=$(perl -e 'print crypt($ARGV[0], "password")' $NAGIOS_PASSWD_CLEAR)

### Set up environnemnt

do_with_root() {
        # already root? "Just do it" (tm).
        if [ `whoami` = 'root' ] ; then
            $*
        elif [ -x /bin/sudo -o -x /usr/bin/sudo ] ; then
            echo
            echo "Sudo detected, Installation will request root privileges to"
            echo "install. You may be prompted for a password. If you prefer to not use"
            echo "sudo, please re-run this script as root."
            echo "sudo $*"
            sudo $*
        else
            echo "Installation requires root privileges to install. Please re-run this script as"
            echo "root."
            exit 1
        fi
    }

### Install prerequisites

do_with_root apt-get update
do_with_root $APT upgrade
do_with_root $APT install build-essential apache2 wget rrdtool bsd-mailx librrds-perl libapache2-mod-php5 php5 php-pear php5-gd php5-ldap php5-snmp libperl-dev rrdtool librrds-perl bind9-host dnsutils bind9utils libradius1 qstat radiusclient1 snmp snmpd libgd2-xpm-dev libpng12-dev libjpeg62 mysql-server php5-mysql libmysqlclient15-dev

do_with_root /usr/sbin/useradd nagios -p $NAGIOS_PASSWD_CRYPT
do_with_root /usr/sbin/usermod -G nagios nagios
do_with_root /usr/sbin/usermod -G nagios www-data
